function getInternetExplorerVersion(){"use strict";var a=-1;if("Microsoft Internet Explorer"===navigator.appName){var b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!==c.exec(b)&&(a=parseFloat(RegExp.$1))}return a}function dataURItoBlob(a){"use strict";for(var b=atob(a.split(",")[1]),c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([c],{type:"image/jpeg"})}function getCurrentUrl(){"use strict";var a=window.location.href;return-1!==a.indexOf("#")&&(a=a.substr(0,a.indexOf("#"))),a}function checkAndAdd(a,b,c){"use strict";for(var d=0;d<b.length;d++){var e=b[d];if(e.instrument_id===a)return c.push(e),!0}return!1}function shuffle(a){"use strict";for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}function log(a){"use strict";debug&&void 0!==console&&void 0!==console.log&&console.log(a)}function getStars(a){"use strict";for(var b="",c=0,d=1;5>=d;d++){if(!(a>=d)){a%1!==0&&(c++,b+='<span class="star halfstar"></span>');break}c++,b+='<span class="star fullstar"></span>'}for(;5>c;)b+='<span class="star emptystar"></span>',c++;return b}function getStarsFromScore(a){"use strict";a=parseInt(a,10);var b=.5*(a+1);return getStars(b)}function saveData(a,b){"use strict";void 0!==localStorage&&localStorage.setItem(a,JSON.stringify(b))}function clearData(a){"use strict";void 0!==localStorage&&localStorage.removeItem(a)}function loadData(a){"use strict";return void 0!==localStorage?null===localStorage.getItem(a)?null:JSON.parse(localStorage.getItem(a)):null}function fullscreenFormNext(a){"use strict";var b=$(a).find("fieldset.active").eq(0);$(".fullscreenform fieldset.error").removeClass("error");var c=$(b).next();if(c.length>0){var d=$(b).find("input, select");$.each(d,function(a,b){"email"!==$(b).attr("data-type")||""!==$(b).val()&&emailCheck.test($(b).val())?"password"===$(b).attr("data-type")&&(""===$(b).val()||$(b).val().length<6)?$(b).closest("fieldset").addClass("error"):"select"===$(b).attr("data-type")&&""===$(b).val()?$(b).closest("fieldset").addClass("error"):""===$(b).val()&&$(b).closest("fieldset").addClass("error"):$(b).closest("fieldset").addClass("error")})}if($(".fullscreenform fieldset.error").length>0);else{$(b).addClass("fading-out").removeClass("active"),window.setTimeout(function(){$(b).removeClass("fading-out")},1e3),$(c).addClass("active"),$(c).find("input").focus(),$(a).find(".formcontroller").removeClass("active");var e=c.data("field"),f=$(a).find('.formcontroller[data-field="'+e+'"]');$(f).addClass("enabled active")}}function fullscreenFormGoTo(a,b){"use strict";var c=$(a).find("fieldset.active").eq(0);$(".fullscreenform fieldset.error").removeClass("error");var d=$(a).find('fieldset[data-field="'+b+'"]');if(parseInt($(d).data("field"),10)>parseInt($(c).data("field"),10)){var e=$(c).find("input, select");$.each(e,function(a,b){"email"!==$(b).attr("data-type")||""!==$(b).val()&&emailCheck.test($(b).val())?"select"===$(b).attr("data-type")&&""===$(b).val()?$(b).closest("fieldset").addClass("error"):""===$(b).val()&&$(b).closest("fieldset").addClass("error"):$(b).closest("fieldset").addClass("error")})}if($(".fullscreenform fieldset.error").length>0);else{$(c).addClass("fading-out").removeClass("active"),window.setTimeout(function(){$(c).removeClass("fading-out")},1e3),$(d).addClass("active"),$(d).find("input").focus(),$(a).find(".formcontroller").removeClass("active");var f=$(a).find('.formcontroller[data-field="'+b+'"]');$(f).addClass("enabled active")}}function App(){"use strict";var a=this;a.currentLanguage=settings.language?settings.language:"fi_fi",a.translations={},a.lockTagit=!1,a.view=null,a.showLoader=!1,a.user={loggedIn:!1,data:{}},a.matchOpen=!1,a.matchArea=!1,a.matchKeywords="",a.linkedinData=!1,a.filterAjax=!1,a.possibilityAjax=!1,a.matchAjax=!1,a.imageCropperEnabled=!0,a.loading={start:function(){a.showLoader&&NProgress.start()},trickle:function(){NProgress.inc()},stop:function(){NProgress.done()}},a.loadTranslation=function(b,c){var d=new $.Deferred;return $.get(c,function(c){void 0!==c&&(a.translations[b]=c,d.resolve("OK"))},"json"),d.promise()},a.scrollUp=function(){$("html,body").animate({scrollTop:0},200)},a.getParsedData=function(b){function c(a,b){void 0!==b&&e.push({field:a,value:b.replace(/(<([^>]+)>)/gi,"")})}var d=a.translations[a.currentLanguage].job.fields,e=[];return c(d.contact,b.json_ad.yhteystiedotKevytHTML),c(d.job_pay,b.json_ad.palkkausteksti),c(d.job_experience,b.json_ad.tyokokemus),c(d.job_starts,b.json_ad.tyoAlkaaTekstiYhdistetty),c(d.job_time,b.json_ad.tyoaikatekstiYhdistetty),c(d.duration,b.json_ad.tyonKesto),c(d.search_ends,b.json_ad.hakuPaattyy),c(d.job_published,moment(b.json_ad.ilmoituspaivamaara).format("L")),e},a.getApiUrl=function(a){var b=config.backendUrl+"/"+config.apiPath+"/";return b+=a},a.apiCall=function(b,c,d,e,f,g){var h={};void 0!==settings.apiToken&&(h.Authorization="Bearer "+settings.apiToken),void 0!==settings.tempToken&&(h.MazhrSession=settings.tempToken);var i={type:f,headers:h,dataType:"JSON",data:c};void 0!==g&&g===!0&&(i.processData=!1,i.contentType=!1);var j=$.ajax(a.getApiUrl(b),i).done(function(a){d(a)}).fail(function(a,b,c){e(a,b,c)});return j},a.fetchLinkedin=function(){a.loading.start();var b=a.user.data.filters.profession_code.value,c=a.user.data.filters.area.value;window.location=config.backendUrl+"/linkedin?mazhr_token="+settings.tempToken+"&what="+b+"&where="+c+"&ok_url="+encodeURIComponent(config.appUrl+"#settings")+"&fail_url="+encodeURIComponent(config.appUrl+"#settings")},a.changeEmail=function(){var b=$("#emailfield").val();if(""!==b&&emailCheck.test(b)){a.apiCall("me",JSON.stringify({data:{email:b}}),function(){a.message("email_success"),a.redrawAll()},function(){a.message("email_error")},"POST")}else a.message("email_incorrect")},a.forgotPassword=function(){var b=$("#forgot-password").val();""!==b&&emailCheck.test(b)?$.ajax(a.getApiUrl("password"),{type:"post",dataType:"JSON",data:{email:b}}).done(function(){a.message("forgot_success"),$("#form-forgot-password").slideUp(),$("#forgot-password").val("")}).fail(function(){a.message("email_incorrect")}):a.message("email_incorrect")},a.changePassword=function(){if($("#password_1").val().length<6||$("#password_1").val()!==$("#password_2").val())a.message("password_incorrect");else{a.apiCall("me/password",{password:$("#password_1").val()},function(){a.message("password_success"),a.redrawAll()},function(){a.message("password_error")},"POST")}},a.savePrivacy=function(){var b={public_profile:0,show:""};$("#privacy-public").is(":checked")&&(b.public_profile=1,$.each($('#privacy-checkboxes input[type="checkbox"]:checked'),function(a,c){b.show=b.show+","+$(c).attr("name")})),""!==b.show&&(b.show=b.show.slice(1));a.apiCall("me/privacy",JSON.stringify({data:b}),function(b){a.user.data.privacy=b.data,a.message("privacy_success"),a.redrawAll(!0)},function(){a.message("privacy_error")},"POST")},a.removeAccount=function(){var b=a.translations[a.currentLanguage].alerts.messages;sweetAlert({title:b.profile_delete_confirm_1.title,text:b.profile_delete_confirm_1.message,type:b.profile_delete_confirm_1.type,showCancelButton:!0,confirmButtonColor:config.destructiveButtonColor,confirmButtonText:b.profile_delete_confirm_1.button_ok,cancelButtonText:b.profile_delete_confirm_1.button_cancel,closeOnConfirm:!1},function(){sweetAlert({title:b.profile_delete_confirm_2.title,text:b.profile_delete_confirm_2.message,type:b.profile_delete_confirm_2.type,showCancelButton:!0,confirmButtonColor:config.destructiveButtonColor,confirmButtonText:b.profile_delete_confirm_2.button_ok,cancelButtonText:b.profile_delete_confirm_2.button_cancel,closeOnConfirm:!0,html:!0},function(){a.apiCall("me/remove",{},function(){a.message("remove_success"),a.logout()},function(){a.message("remove_error")},"POST")})})},a.loginCheck=function(b,c){var d=a.apiCall("me",{},function(c){void 0!==c.metadata.tmpToken?(settings.tempToken=c.metadata.tmpToken,saveData(config.datastore,settings),a.checkMessages()):a.logout(),a.user.loggedIn=!0,a.user.data=c.data,a.user.metadata=c.metadata,b(c)},function(d){var e=JSON.parse(d.responseText);delete settings.apiToken,void 0!==e.tmpToken&&(settings.tempToken=e.tmpToken),saveData(config.datastore,settings),a.checkMessages(),void 0!==settings.tempToken?a.apiCall("register",{},function(d){void 0!==d.metadata.mazhr_token?(settings.apiToken=d.metadata.mazhr_token,saveData(config.datastore,settings),a.user.loggedIn=!0,a.user.data=d.data,a.user.metadata=d.metadata,b(d)):(delete settings.apiToken,saveData(config.datastore,settings),void 0!==d.metadata.linkedinData&&(a.linkedinData=d.metadata.linkedinData),a.user.loggedIn=!1,a.user.data={},a.user.metadata={},c())},function(){delete settings.apiToken,saveData(config.datastore,settings),a.user.loggedIn=!1,a.user.data={},a.user.metadata={},c()},"POST"):(a.user.loggedIn=!1,a.user.data={},a.user.metadata={},c())},"GET");return d},a.checkMessages=function(){var b=a.apiCall("messages",{},function(b){""!==b.message&&a.message(b.message)},function(){},"GET");return b},a.updateTestProgress=function(){var b=a.user.metadata;if(void 0!==b&&void 0!==b.tests&&void 0!==b.testsDone){var c=a.translations[a.currentLanguage],d=parseInt(b.tests,10)-parseInt(b.testsDone,10);0===d?$('.pageselector[data-page="tests"] .notifier').length>0&&$('.pageselector[data-page="tests"] .notifier').remove():0===$('.pageselector[data-page="tests"] .notifier').length?$('.pageselector[data-page="tests"]').append('<div class="notifier" title="'+c.tests_left+'">'+d+"</div>"):$('.pageselector[data-page="tests"]').find(".notifier").html(d)}else a.apiCall("me",{},function(b){a.user.data=b.data,a.user.metadata=b.metadata,a.updateTestProgress()},function(){a.message("generic_error")},"GET")},a.refreshTempToken=function(b,c){var d=a.apiCall("me",{},function(a){void 0!==a.metadata.tmpToken?(settings.tempToken=a.metadata.tmpToken,saveData(config.datastore,settings),b()):c()},function(){c()},"GET");return d},a.message=function(b){var c=a.translations[a.currentLanguage],d=c.alerts.messages[b],e=d.title,f=d.message,g=d.type;sweetAlert({title:e,text:f,type:g,confirmButtonText:c.alerts.messages.ok,confirmButtonColor:config.confirmButtonColor})},a.hashChanged=function(){return"#job"===window.location.hash.split("-")[0]?!1:void(window.location.hash!==App.view&&a.showView(window.location.hash))},a.changeLanguage=function(b){void 0!==a.translations[b]&&(a.currentLanguage=b,moment.locale(a.translations[a.currentLanguage].moment_lang),a.matchOpen=!1,a.matchArea=!1,a.matchKeywords="",$.when($("#app").fadeOut(300)).then(function(){a.redrawAll(),$("#app").delay(200).fadeIn(300)}),settings.language=b,saveData(config.datastore,settings))},a.render=function(a,b,c,d){void 0===c&&(c="#content-page"),void 0===d&&(d=!1);var e=$(a).html(),f=window.Handlebars.compile(e),g=f(b);d?$(c).append(g):$(c).html(g)},a.redrawAll=function(b){a.showView(a.view,!0,b)},a.parsePosition=function(b,c){var d,e,f,g={lang:a.translations[a.currentLanguage]},h=c.start_month+"/"+c.start_year;1===c.current?(d=g.lang.profile.time_current,f=moment.duration(moment().diff(moment(h,"M/YYYY"))),c.not_ended=!0):(d=c.end_month+"/"+c.end_year,f=moment.duration(moment(d,"M/YYYY").diff(moment(h,"M/YYYY")))),0!==f.asYears()?(e=Math.round(f.asYears()),e+=1===e?" "+g.lang.date_year_single:" "+g.lang.date_years):(e=Math.round(f.asMonths()),e+=1===e?" "+g.lang.date_month_single:" "+g.lang.date_months),c.start_pretty=h,c.end_pretty=d,c.duration_pretty=e,c.end_month=null===c.end_month?"":c.end_month,c.end_year=null===c.end_year?"":c.end_year,c.keywords_array=null!==c.keywords&&""!==c.keywords?c.keywords.split(","):[]},a.parseEducation=function(b,c){var d,e={lang:a.translations[a.currentLanguage]};1===c.current?(d=e.lang.profile.form.education_not_ended,c.not_ended=!0):d=e.lang.profile.form.end_year+" "+c.end_year,c.duration_pretty=d,c.keywords_array=null!==c.keywords&&""!==c.keywords?c.keywords.split(","):[]},a.getTests=function(){var b=a.apiCall("tests",{},function(b){var c={lang:a.translations[a.currentLanguage]};c.tests=b.data,a.user.data.tests.length&&$.each(a.user.data.tests,function(a,b){if(void 0!==c.tests[b.instrument_id]){c.tests[b.instrument_id].content=b;var d,e=c.tests[b.instrument_id].name,f=c.tests[b.instrument_id].content.score+"";if(1===f.length&&""!==c.tests[b.instrument_id].content.score_key&&null!==c.tests[b.instrument_id].content.score_key){var g={value:f,text:{title:c.lang.tests.testdata[e].name,description:c.lang.tests.result_texts[f]}},h=window.Handlebars.compile($("#diagram-template").html()),i=h(g);d=i}else d='<p class="scoretext">'+c.tests[b.instrument_id].content.score+"</p>";var j=!1;1===c.tests[b.instrument_id].content.status&&(j=!0);var k=!1;3===c.tests[b.instrument_id].content.status&&(k=!0),c.tests[b.instrument_id].content.formatted_score=d,c.tests[b.instrument_id].paid=j,c.tests[b.instrument_id].payment_pending=k}}),$.each(c.tests,function(a,b){b.replaced_price=b.price.replace(".",","),b.text=c.lang.tests.testdata[b.name],0===parseInt(b.price,10)?(b.text.buy=c.lang.tests.claim_test,b.not_free=!1):(b.text.buy=c.lang.tests.buy_test,b.not_free=!0)}),c.backendUrl=config.backendUrl,c.appUrl=config.appUrl;var d=[102,201,302,301,357,315],e={},f={},g={};$.each(d,function(a,b){void 0!==c.tests[b]&&(void 0!==c.tests[b].content&&null!==c.tests[b].content.score_key?e["test_"+b]=c.tests[b]:f["test_"+b]=c.tests[b],delete c.tests[b])}),$.each(c.tests,function(a,b){f[a]=b}),void 0!==e.test_102?(g.test_102=e.test_102,delete e.test_102):void 0!==f.test_102&&(g.test_102=f.test_102,delete f.test_102),$.each(e,function(a,b){g[a]=b}),$.each(f,function(a,b){g[a]=b}),c.tests=g,a.render("#content-page-tests-template",c,"#content-page"),$.each($("#page-tests .custom-select"),function(a,b){$(b).find("select").off().on("change",function(){$(this).closest(".custom-select").find("label").html($(this).find("option:selected").text())})}),$('.test[data-test="shapes"]').addClass("open"),$('.test[data-test="shapes"]').find(".info").css({display:"block"}),void 0!==settings.openTests&&($.each(settings.openTests,function(a,b){var c=$('.test[data-test="'+b+'"]');$(c).addClass("open"),$(c).find(".info").css({display:"block"})}),delete settings.openTests,saveData(config.datastore,settings))},function(){},"GET");return b},a.startTest=function(b,c,d){a.loading.start(),a.saveOpenTests();var e=config.backendUrl+"/cute/test?mazhr_token="+settings.tempToken+"&instrument="+b+"&testid="+c+"&lang="+d+"&return_url="+config.appUrl+"loading/&fail_url="+encodeURIComponent(config.appUrl+"#tests");window.location=e},a.resetPayment=function(b){var c=a.translations[a.currentLanguage].alerts.messages;sweetAlert({title:c.test_resetpayment_confirm.title,text:c.test_resetpayment_confirm.message,type:c.test_resetpayment_confirm.type,showCancelButton:!0,confirmButtonColor:config.destructiveButtonColor,confirmButtonText:c.test_resetpayment_confirm.button_ok,cancelButtonText:c.test_resetpayment_confirm.button_cancel,closeOnConfirm:!1},function(){a.loading.start(),a.saveOpenTests();a.apiCall("test/reset/"+b,{},function(b){a.user.data.tests=b.data,$.when(a.getTests()).then(function(){sweetAlert({confirmButtonColor:config.confirmButtonColor,title:c.test_resetpayment_success.title,text:c.test_resetpayment_success.message,type:c.test_resetpayment_success.type}),a.loading.stop()})},function(){a.message("generic_error"),a.loading.stop()},"POST")})},a.onLeaveCheck=function(b,c,d){if(void 0!==b&&b===!0)c();else if($(".editor.editing").length>0){var e=a.translations[a.currentLanguage].alerts.messages;sweetAlert({title:e.profile_leave_confirm.title,text:e.profile_leave_confirm.message,type:e.profile_leave_confirm.type,showCancelButton:!0,confirmButtonColor:config.destructiveButtonColor,confirmButtonText:e.profile_leave_confirm.button_ok,cancelButtonText:e.profile_leave_confirm.button_cancel,closeOnConfirm:!0},function(a){a?c():d()})}else c()},a.resetTest=function(b){var c=a.translations[a.currentLanguage].alerts.messages;sweetAlert({title:c.test_reset_confirm.title,text:c.test_reset_confirm.message,type:c.test_reset_confirm.type,showCancelButton:!0,confirmButtonColor:config.destructiveButtonColor,confirmButtonText:c.test_reset_confirm.button_ok,cancelButtonText:c.test_reset_confirm.button_cancel,closeOnConfirm:!1},function(){a.loading.start();a.apiCall("test/reset/"+b,{},function(b){a.user.data.tests=b.data,a.user.metadata=b.metadata,a.updateTestProgress(),$.when(a.getTests()).then(function(){sweetAlert({confirmButtonColor:config.confirmButtonColor,title:c.test_reset_success.title,text:c.test_reset_success.message,type:c.test_reset_success.type}),a.loading.stop()})},function(){a.message("generic_error"),a.loading.stop()},"POST")})},a.getMatches=function(){a.matchAjax!==!1&&(a.matchAjax.abort(),a.matchAjax=!1);var b={lang:a.translations[a.currentLanguage]};$.each(a.user.data.tests,function(a,c){102===c.instrument_id&&null!==c.score&&null!==c.score_key&&(b.tested=!0)});var c=a.apiCall("match/profiles",{},function(c){a.matchAjax=!1,b.matches=c.data,$.each(b.matches,function(a,c){c.realname=b.lang.frontpage.match_profiles[c.code],c.scoredom=getStarsFromScore(c.score)}),a.render("#content-sidebar-frontpage-template",b,"#content-sidebar")},function(){a.matchAjax=!1},"GET");return a.matchAjax=c,c},a.getPossibilities=function(){a.possibilityAjax!==!1&&(a.possibilityAjax.abort(),a.possibilityAjax=!1);var b=a.apiCall("jobs/possibilities",{},function(b){a.possibilityAjax=!1;var c={lang:a.translations[a.currentLanguage]};c.jobs=b.data,c.keywords=a.user.data.filters.keywords?a.user.data.filters.keywords.value:"",c.limited=b.metadata.limited,c.ad_count=b.metadata.ad_count,c.ad_count.difference>0&&(c.ad_count.difference="+"+c.ad_count.difference),a.render("#content-page-frontpage-template",c,"#content-page"),$("#form-possibilities input.text-keywords").tagit({availableTags:c.lang.autocomplete.keywords,afterTagAdded:function(b,c){return c.duringInitialization?!1:void a.checkForFilterUpdate()},afterTagRemoved:function(b,c){return c.duringInitialization?!1:void a.checkForFilterUpdate()}});var d="";void 0!==a.user.data.filters.profession_code&&(d=a.user.data.filters.profession_code.value,$('#possibilities-what option[value="'+d+'"]').length>0&&($('#possibilities-what option[value="'+d+'"]').prop("selected",!0),$("#possibilities-what").closest(".custom-select").find("label").html($("#possibilities-what option:selected").text())));var e="";void 0!==a.user.data.filters.area&&(e=a.user.data.filters.area.value,$('#possibilities-where option[value="'+e+'"]').length>0&&($('#possibilities-where option[value="'+e+'"]').prop("selected",!0),$("#possibilities-where").closest(".custom-select").find("label").html($("#possibilities-where option:selected").text()))),$.each($("#page-frontpage .custom-select"),function(b,c){$(c).find("select").off().on("change",function(){$(this).closest(".custom-select").find("label").html($(this).find("option:selected").text()),a.doFilterUpdate()})}),a.lockTagit=!1,$(".tagit-new input").focus()},function(){a.possibilityAjax=!1,a.lockTagit=!1},"GET");return a.possibilityAjax=b,b},a.saveSummary=function(){var b=({lang:a.translations[a.currentLanguage]},$(this).closest(".editor"));$(b).find(".error").removeClass("error");var c=$(b).find('[name="education_level"]').val();""===c&&$(b).find('[name="education_level"]').closest("fieldset").addClass("error");var d={summary_fulltime:{key:"summary_fulltime",type:1,keywords:"",value:$(b).find('[name="fulltime"]').is(":checked")?1:0},summary_parttime:{key:"summary_parttime",type:1,keywords:"",value:$(b).find('[name="parttime"]').is(":checked")?1:0},summary_shifts:{key:"summary_shifts",type:1,keywords:"",value:$(b).find('[name="shifts"]').is(":checked")?1:0},summary_evenings_weekends:{key:"summary_evenings_weekends",type:1,keywords:"",value:$(b).find('[name="evenings_weekends"]').is(":checked")?1:0},location_home:{key:"location_home",type:1,keywords:"",value:$(b).find('[name="home"]').is(":checked")?1:0},location_abroad:{key:"location_abroad",type:1,keywords:"",value:$(b).find('[name="abroad"]').is(":checked")?1:0},card_sanssi:{key:"card_sanssi",type:1,keywords:"",value:$(b).find('[name="sanssi"]').is(":checked")?1:0},card_duuni:{key:"card_duuni",type:1,keywords:"",value:$(b).find('[name="duuni"]').is(":checked")?1:0},professional_keywords:{key:"professional_keywords",type:2,keywords:$(b).find('[name="professional_keywords"]').val(),value:0}};if(0===$(b).find(".error").length){var e=[],f=!1;e.push(a.apiCall("me",JSON.stringify({data:{education_level:c}}),function(){},function(){f=!0},"POST")),e.push(a.apiCall("me/extras",JSON.stringify({data:d}),function(){},function(){f=!0},"POST")),$.when.apply(null,e).done(function(){a.message(f?"profile_data_save_fail":"profile_data_saved"),a.redrawAll(!0)})}else a.message("profile_data_not_valid")},a.addNewLink=function(){var b=$(this).closest(".new-link").find(".container"),c={lang:a.translations[a.currentLanguage]},d=window.Handlebars.compile($("#form-new-link-template").html()),e=$(d(c));$(b).append(e),$.each($(e).find(".keywords[data-autocomplete]"),function(a,b){$(b).tagit({availableTags:c.lang.autocomplete[$(b).data("autocomplete")]})}),$('#content-page input[type="text"]').placeholder(),$(e).slideDown()},a.saveContact=function(){var b=({lang:a.translations[a.currentLanguage]},$(this).closest(".editor"));$(b).find(".error").removeClass("error");var c,d={},e=[],f=[];if($.each($(b).find(".contact.link"),function(a,b){if($(b).hasClass("remove"))c=$(b).data("linkid"),f.push(c);else{if($(b).hasClass("new")&&""===$(b).find('[name="value"]').val()&&""===$(b).find('[name="keywords"]').val())return!0;$.each($(b).find(".required"),function(a,b){""===$.trim($(b).val())&&$(b).closest("fieldset").addClass("error")});var d={type:1,key:"link_"+e.length,value:$(b).find('[name="value"]').val(),keywords:$(b).find('[name="keywords"]').val(),category:"links"};-1===d.value.indexOf("http://")&&d.value.indexOf("https://")&&(d.value="http://"+d.value),void 0===$(b).data("linkid")||$(b).hasClass("new")||(d.id=$(b).data("linkid")),e.push(d)}}),$.each($(b).find('.contact[data-key="email"]'),function(a,b){""===$(b).find('[name="value"]').val()||emailCheck.test($(b).find('[name="value"]').val())||$(b).find('[name="value"]').closest("fieldset").addClass("error");var c={type:1,key:"contact_email",value:$(b).find('[name="value"]').val(),keywords:$(b).find('[name="keywords"]').val()};""!==$(b).data("id")&&(c.id=$(b).data("id")),d[c.key]=c}),$.each($(b).find('.contact[data-key="phone"]'),function(a,b){var c={type:1,key:"contact_phone",value:$(b).find('[name="value"]').val(),keywords:$(b).find('[name="keywords"]').val()};""!==$(b).data("id")&&(c.id=$(b).data("id")),d[c.key]=c}),0===$(b).find(".error").length){var g=[],h=!1;$.each(f,function(b,c){var d=a.apiCall("me/extras/"+c,{},function(){},function(){h=!0},"DELETE");g.push(d)}),$.each(e,function(b,c){var d={};d[c.key]=c;var e=a.apiCall("me/extras",JSON.stringify({data:d}),function(){},function(){h=!0},"POST");g.push(e)});var i=a.apiCall("me/extras",JSON.stringify({data:d}),function(){},function(){h=!0},"POST");g.push(i),$.when.apply(null,g).done(function(){a.message(h?"profile_data_save_fail":"profile_data_saved"),a.redrawAll(!0)})}else a.message("profile_data_not_valid")},a.addNewLanguage=function(){var b=$(this).closest(".new-languages").find(".container"),c={lang:a.translations[a.currentLanguage]},d=window.Handlebars.compile($("#form-new-language-template").html()),e=$(d(c));$(b).append(e),$.each($(e).find(".keywords[data-autocomplete]"),function(a,b){$(b).tagit({availableTags:c.lang.autocomplete[$(b).data("autocomplete")]})}),$('#content-page input[type="text"]').placeholder(),$(e).slideDown()},a.saveSkills=function(){var b=({lang:a.translations[a.currentLanguage]},$(this).closest(".editor"));$(b).find(".error").removeClass("error");var c,d={},e=[];if($.each($(b).find(".editrow.experience"),function(a,b){$.each($(b).find(".required"),function(a,b){""===$.trim($(b).val())&&$(b).closest("fieldset").addClass("error")});var c=$(b).data("key");d[c]={type:1,key:c,value:$(b).find('[name="years"]').val(),keywords:$(b).find('[name="keywords"]').val(),category:"experience"}}),$.each($(b).find(".editrow.primary-experience"),function(a,b){$.each($(b).find(".required"),function(a,b){""===$.trim($(b).val())&&$(b).closest("fieldset").addClass("error")}),d.primary_experience_type={type:2,key:"primary_experience_type",value:$(b).find('[name="primary-experience-type"]').val(),keywords:$(b).find('[name="keywords"]').val()},d.primary_experience_years={type:3,key:"primary_experience_years",value:$(b).find('[name="primary-experience-years"]').val(),keywords:""}}),$.each($(b).find(".subrow.language"),function(a,b){if($(b).hasClass("remove"))c=$(b).data("languageid"),e.push(c);else{if($(b).hasClass("new")&&""===$(b).find('[name="language"]').val()&&""===$(b).find('[name="language-skill"]').val()&&""===$(b).find('[name="keywords"]').val())return!0;$.each($(b).find(".required"),function(a,b){""===$.trim($(b).val())&&$(b).closest("fieldset").addClass("error")}),d[$(b).find('[name="language"]').val()]={type:1,key:$(b).find('[name="language"]').val(),value:$(b).find('[name="language-skill"]').val(),keywords:$(b).find('[name="keywords"]').val(),category:"languages"},void 0===$(b).data("languageid")||$(b).hasClass("new")||(d[$(b).find('[name="language"]').val()].id=$(b).data("languageid"))}}),0===$(b).find(".error").length){var f=[],g=!1;$.each(e,function(b,c){var d=a.apiCall("me/skills/"+c,{},function(){},function(){g=!0},"DELETE");f.push(d)});var h=a.apiCall("me/skills",JSON.stringify({data:d}),function(){},function(){g=!0},"POST");f.push(h),$.when.apply(null,f).done(function(){a.message(g?"profile_data_save_fail":"profile_data_saved"),a.redrawAll(!0)})}else a.message("profile_data_not_valid")},a.addNewEducation=function(){var b=$(this).closest(".new-education").find(".container"),c={lang:a.translations[a.currentLanguage]},d=window.Handlebars.compile($("#form-new-education-template").html()),e=$(d(c));$(b).append(e),$.each($(e).find(".keywords[data-autocomplete]"),function(a,b){$(b).tagit({availableTags:c.lang.autocomplete[$(b).data("autocomplete")]})}),$.each($(e).find('input[data-autocomplete="degrees"]'),function(a,b){$(b).autocomplete({source:c.lang.autocomplete[$(b).data("autocomplete")]})}),$('#content-page input[type="text"]').placeholder(),$(e).slideDown()},a.saveEducation=function(){var b=({lang:a.translations[a.currentLanguage]},$(this).closest(".editor"));$(b).find(".error").removeClass("error");var c,d=[],e=[];if($.each($(b).find(".education"),function(a,b){if($(b).hasClass("remove"))c=$(b).data("educationid"),e.push(c);else{if($(b).hasClass("new")&&""===$(b).find('[name="level"]').val()&&""===$(b).find('[name="school"]').val()&&""===$(b).find('[name="degree"]').val()&&""===$(b).find('[name="end_year"]').val()&&""===$(b).find('[name="keywords"]').val()&&!$(b).find('[name="not_ended"]').is(":checked"))return!0;$.each($(b).find(".required"),function(a,b){""===$.trim($(b).val())&&$(b).closest("fieldset").addClass("error")}),$.each($(b).find(".number"),function(a,b){""!==$(b).val()&&0===parseInt($(b).val(),10)&&$(b).closest("fieldset").addClass("error"),$(b).hasClass("year")&&""!==$(b).val()&&(parseInt($(b).val(),10)<1e3||parseInt($(b).val(),10)>3e3)&&$(b).closest("fieldset").addClass("error")}),$(b).find('[name="not_ended"]').is(":checked")||(""===$.trim($(b).find('[name="end_year"]').val())||parseInt($(b).find('[name="end_year"]').val(),10)<1e3||parseInt($(b).find('[name="end_year"]').val(),10)>3e3)&&$(b).find('[name="end_year"]').closest("fieldset").addClass("error");var f={level:$(b).find('[name="level"]').val(),school:$(b).find('[name="school"]').val(),degree:$(b).find('[name="degree"]').val(),keywords:$(b).find('[name="keywords"]').val()};$(b).find('[name="not_ended"]').is(":checked")?(f.current=1,f.end_year=""):(f.current=0,f.end_year=$(b).find('[name="end_year"]').val()),void 0===$(b).data("educationid")||$(b).hasClass("new")||(f.id=$(b).data("educationid")),d.push(f)}}),0===$(b).find(".error").length){var f=[],g=!1;$.each(e,function(b,c){var d=a.apiCall("me/education/"+c,{},function(){},function(){g=!0},"DELETE");f.push(d)});var h=a.apiCall("me/education",JSON.stringify({data:d}),function(){},function(){g=!0},"POST");f.push(h),$.when.apply(null,f).done(function(){a.message(g?"profile_data_save_fail":"profile_data_saved"),a.redrawAll(!0)})}else a.message("profile_data_not_valid")},a.addNewPosition=function(){var b=$(this).closest(".new-positions").find(".container"),c={lang:a.translations[a.currentLanguage]},d=window.Handlebars.compile($("#form-new-position-template").html()),e=$(d(c));$(b).append(e),$.each($(e).find(".keywords[data-autocomplete]"),function(a,b){$(b).tagit({availableTags:c.lang.autocomplete[$(b).data("autocomplete")]})}),$('#content-page input[type="text"]').placeholder(),$(e).slideDown()},a.savePositions=function(){var b=({lang:a.translations[a.currentLanguage]},$(this).closest(".editor"));$(b).find(".error").removeClass("error");var c,d=[],e=[];if($.each($(b).find(".position"),function(a,b){if($(b).hasClass("remove"))c=$(b).data("positionid"),e.push(c);else{if($(b).hasClass("new")&&""===$(b).find('[name="company"]').val()&&""===$(b).find('[name="title"]').val()&&""===$(b).find('[name="start_month"]').val()&&""===$(b).find('[name="start_year"]').val()&&""===$(b).find('[name="end_month"]').val()&&""===$(b).find('[name="end_year"]').val()&&""===$(b).find('[name="keywords"]').val()&&!$(b).find('[name="not_ended"]').is(":checked"))return!0;$.each($(b).find(".required"),function(a,b){""===$.trim($(b).val())&&$(b).closest("fieldset").addClass("error")}),$.each($(b).find(".number"),function(a,b){""!==$(b).val()&&0===parseInt($(b).val(),10)&&$(b).closest("fieldset").addClass("error"),$(b).hasClass("month")&&""!==$(b).val()&&parseInt($(b).val(),10)>12&&$(b).closest("fieldset").addClass("error"),$(b).hasClass("year")&&""!==$(b).val()&&(parseInt($(b).val(),10)<1e3||parseInt($(b).val(),10)>3e3)&&$(b).closest("fieldset").addClass("error")}),$(b).find('[name="not_ended"]').is(":checked")||((""===$.trim($(b).find('[name="end_month"]').val())||parseInt($(b).find('[name="end_month"]').val(),10)>12)&&$(b).find('[name="end_month"]').closest("fieldset").addClass("error"),(""===$.trim($(b).find('[name="end_year"]').val())||parseInt($(b).find('[name="end_year"]').val(),10)<1e3||parseInt($(b).find('[name="end_year"]').val(),10)>3e3)&&$(b).find('[name="end_year"]').closest("fieldset").addClass("error"));var f={company:$(b).find('[name="company"]').val(),start_month:$(b).find('[name="start_month"]').val(),start_year:$(b).find('[name="start_year"]').val(),title:$(b).find('[name="title"]').val(),keywords:$(b).find('[name="keywords"]').val()};$(b).find('[name="not_ended"]').is(":checked")?(f.current=1,f.end_month="",f.end_year=""):(f.current=0,f.end_month=$(b).find('[name="end_month"]').val(),f.end_year=$(b).find('[name="end_year"]').val()),void 0===$(b).data("positionid")||$(b).hasClass("new")||(f.id=$(b).data("positionid")),d.push(f)}}),0===$(b).find(".error").length){var f=[],g=!1;$.each(e,function(b,c){var d=a.apiCall("me/workhistory/"+c,{},function(){},function(){g=!0},"DELETE");f.push(d)});var h=a.apiCall("me/workhistory",JSON.stringify({data:d}),function(){},function(){g=!0},"POST");f.push(h),$.when.apply(null,f).done(function(){a.message(g?"profile_data_save_fail":"profile_data_saved"),a.redrawAll(!0)})}else a.message("profile_data_not_valid")},a.updateFilters=function(b,c,d){a.filterAjax!==!1&&(a.filterAjax.abort(),a.filterAjax=!1);var e=a.apiCall("me/filters",JSON.stringify({data:{keywords:d,area:c,profession_code:b}}),function(b){a.filterAjax=!1,(void 0===a.user.data.filters||void 0===a.user.data.filters.profession_code||void 0===a.user.data.filters.profession_code.value||void 0===a.user.data.filters.area||void 0===a.user.data.filters.area.value||void 0===a.user.data.filters.keywords||void 0===a.user.data.filters.keywords.value||a.user.data.filters.profession_code.value!==b.data.profession_code.value||a.user.data.filters.area.value!==b.data.area.value||a.user.data.filters.keywords.value!==b.data.keywords.value)&&(a.user.data.filters=b.data,a.getPossibilities(),a.getMatches())
},function(){a.filterAjax=!1},"POST");return a.filterAjax=e,e},a.doFilterUpdate=function(){var b=$("#form-possibilities"),c=$(b).find('select[name="what"]').val(),d=$(b).find('select[name="where"]').val(),e=$(b).find('input[name="keywords"]').val();a.updateFilters(c,d,e)},a.checkForFilterUpdate=function(){if(!a.lockTagit){a.lockTagit=!0;var b=$("#form-possibilities"),c=$(b).find('select[name="what"]').val(),d=$(b).find('select[name="where"]').val(),e=$(b).find('input[name="keywords"]').val();e!==a.user.data.filters.keywords.value?a.updateFilters(c,d,e):a.lockTagit=!1}},a.saveProfileImage=function(b){var c=new FormData,d=dataURItoBlob(b);c.append("image",d);var e=a.apiCall("me",c,function(b){a.user.data=b.data,a.user.metadata=b.metadata,a.updateTestProgress(),$("#uploader").fadeOut(200),a.redrawAll(!0)},function(){a.message("uploader_save_error"),$("#uploader").fadeOut(200)},"POST",!0);return e},a.openJob=function(b){a.loading.start();var c="job/"+b;if(a.matchOpen!==!1&&1===$(".match.active").eq(0).length){var d=$(".match.active").eq(0).data("matchid");c+="/profile/"+d}window.location.hash="job-"+b;var e=a.apiCall(c,{},function(b){$("#button-back").attr("class","close-job").fadeIn(200);var c={lang:a.translations[a.currentLanguage]};if(c.job=b.data,$.each(a.user.data.tests,function(a,b){102===b.instrument_id&&null!==b.score&&null!==b.score_key&&(c.tested=!0,log(c.job.profile),void 0!==c.job.profile&&void 0!==c.job.profile.score&&(c.job.scoredom=getStarsFromScore(c.job.profile.score)))}),void 0!==c.job.profile){var d=c.job.profile.competences;d=shuffle(d),d=d.slice(0,2);var e=[];$.each(d,function(a,b){e.push(c.lang.job.competences[b])});var f=c.job.profile.behavioral_models;f=shuffle(f),f=f.slice(0,2);var g=[];$.each(f,function(a,b){g.push(c.lang.job.behavioral_models[b])}),c.job.profile={competences:e,behavioral_models:g}}c.job.parsed=a.getParsedData(c.job),c.job.url="http://www.mol.fi/tyopaikat/tyopaikkatiedotus/haku/"+c.job.json_ad.ilmoitusnumero+"_fi.htm",c.fromMatch=a.matchOpen!==!1,$.when($("#content-sidebar").fadeOut(200),$("#page-frontpage").fadeOut(200),$("#page-match").fadeOut(200)).then(function(){a.render("#content-sidebar-job-template",c,"#sidebar-job"),a.render("#content-page-job-template",c,"#page-job"),a.scrollUp(),$("#sidebar-frontpage").hide(),$("#sidebar-job").show(),$("#content-sidebar").fadeIn(200),$(".sidebar-job .anim-in").css({opacity:0}),$("#page-job").fadeIn(200,function(){a.loading.stop(),$.each($(".sidebar-job .anim-in"),function(a,b){var c=b;setTimeout(function(){$(c).animate({opacity:1},300)},150*a)})})})},function(){a.loading.stop()},"GET");return e},a.refreshMatch=function(b,c){a.loading.start(),a.matchArea=c,a.openMatch(b,!0)},a.openMatch=function(b,c){function d(){a.apiCall("jobs/matches/"+b,{area:a.matchArea,keywords:a.matchKeywords},function(d){$("#button-back").attr("class","close-match");var e={lang:a.translations[a.currentLanguage]};e.jobs=d.data,e.match={score:f,scoredom:getStarsFromScore(f),name:e.lang.frontpage.match_profiles[d.metadata.code].toLowerCase()},a.matchOpen=e.match,$.when($("#page-frontpage").fadeOut(200)).then(function(){a.loading.trickle(),a.render("#content-page-match-template",e,"#page-match"),$('#match-possibilities-where option[value="'+a.matchArea+'"]').length>0&&($('#match-possibilities-where option[value="'+a.matchArea+'"]').prop("selected",!0),$("#match-possibilities-where").closest(".custom-select").find("label").html($("#match-possibilities-where option:selected").text())),$.each($("#page-match .custom-select"),function(c,d){$(d).find("select").off().on("change",function(){$(this).closest(".custom-select").find("label").html($(this).find("option:selected").text()),a.refreshMatch(b,$(this).val())})}),$("#form-match-possibilities input.text-keywords").val(a.matchKeywords),$("#form-match-possibilities input.text-keywords").tagit({availableTags:e.lang.autocomplete.keywords,afterTagAdded:function(c,d){return d.duringInitialization?!1:(a.matchKeywords=$("#form-match-possibilities input.text-keywords").val(),void a.refreshMatch(b,a.matchArea))},afterTagRemoved:function(c,d){return d.duringInitialization?!1:(a.matchKeywords=$("#form-match-possibilities input.text-keywords").val(),void a.refreshMatch(b,a.matchArea))}}),(void 0===c||c===!1)&&a.scrollUp(),$("#page-match").fadeIn(200,function(){a.loading.stop()})})},function(){a.loading.stop()},"GET")}a.loading.start(),a.matchOpen=!0,a.matchArea===!1&&(a.matchArea=a.user.data.filters.area.value),$('.pageselector[data-page="frontpage"]').removeClass("active"),$(".match").removeClass("active");var e=$('.match[data-matchid="'+b+'"]');$(e).addClass("active");var f=$(e).data("score");void 0!==c&&c===!0?d():$.when($("#page-match").fadeOut(200)).then(function(){a.loading.trickle(),d()})},a.closeMatch=function(){$(".match").removeClass("active"),a.matchOpen=!1,a.matchArea=!1,a.matchKeywords="",$.when($("#page-match").fadeOut(200),$("#button-back").attr("class","")).then(function(){$("#page-frontpage").fadeIn(200)})},a.submitDiscount=function(b,c){a.loading.start();a.apiCall("test/discount",{test_id:b,code:c},function(){$.when(a.getTests()).then(function(){a.message("discount_code_success"),a.loading.stop()})},function(){a.message("discount_code_failed"),a.loading.stop()},"POST")},a.closeJob=function(){({lang:a.translations[a.currentLanguage]});window.location.hash="frontpage",a.matchOpen!==!1?$.when($("#content-sidebar").fadeOut(200),$("#page-job").fadeOut(200),$("#button-back").attr("class","").fadeOut(200)).then(function(){$("#sidebar-job").hide().html(""),$("#page-job").html(""),$("#sidebar-frontpage").show(),$("#content-sidebar").fadeIn(200),$("#page-match").fadeIn(200)}):$.when($('.pageselector[data-page="frontpage"]').addClass("active"),$("#content-sidebar").fadeOut(200),$("#page-job").fadeOut(200),$("#button-back").attr("class","").fadeOut(200)).then(function(){$("#sidebar-job").hide().html(""),$("#page-job").html(""),$("#sidebar-frontpage").show(),$("#content-sidebar").fadeIn(200),$("#page-frontpage").fadeIn(200)})},a.saveOpenTests=function(){var a=[];$.each($("#page-tests .test.open"),function(b,c){var d=$(c).data("test");a.push(d)}),settings.openTests=a,saveData(config.datastore,settings)},a.login=function(b,c,d){var e={email:b,password:c};d&&(e.remember_me=!0);var f=a.apiCall("login",e,function(b){settings.apiToken=b.metadata.mazhr_token,saveData(config.datastore,settings),a.user.loggedIn=!0,a.user.data=b.data,a.user.metadata=b.metadata,a.showView("#frontpage"),$("#start").fadeOut(400,function(){var a=$("#form-login");$(a).find('input[name="email"]').val(""),$(a).find('input[name="password"]').val(""),$(a).find('input[name="remember-me"]').prop("checked",!1),$("#app").fadeIn()})},function(){a.message("login_failed")},"POST");return f},a.logout=function(){a.loading.start(),delete settings.apiToken,delete settings.tempToken,delete settings.openTests,saveData(config.datastore,settings),a.user.loggedIn=!1,a.user.data={},a.user.metadata={},a.linkedinData={},a.matchOpen=!1,a.matchArea=!1,a.matchKeywords="",a.lockTagit=!1,a.showLoader=!1,a.filterAjax=!1,a.possibilityAjax=!1,a.matchAjax=!1,a.showView("#start"),$("#app").fadeOut(400,function(){$("#start").fadeIn(400,function(){a.loading.stop(),$("#content-page").html("");a.apiCall("me",{},function(a){void 0!==a.metadata.tmpToken?(settings.tempToken=a.metadata.tmpToken,saveData(config.datastore,settings)):location.reload()},function(a){var b=JSON.parse(a.responseText);void 0!==b.tmpToken?(settings.tempToken=b.tmpToken,saveData(config.datastore,settings)):location.reload()},"GET")})})},a.updateMenu=function(b){var c={lang:a.translations[a.currentLanguage]};a.render("#menu-template",c,"#menu");var d=$('#menu [data-page="'+b+'"]');d.length>0&&$(d).addClass("active"),a.updateTestProgress()},a.showView=function(b,c,d){a.user.loggedIn===!1?-1===config.publicViews.indexOf(b)&&(b="#start"):-1===config.allowedViews.indexOf(b)&&(b="#frontpage"),a.onLeaveCheck(d,function(){if(c===!0||a.view!==b){var d={lang:a.translations[a.currentLanguage]};switch(a.view=b,window.location.hash=a.view,b){case"#start":d.backendUrl=config.backendUrl,$.when($("#start").fadeOut(400)).then(function(){a.render("#content-page-start-template",d,"#start"),$("#start").fadeIn(400)});break;case"#login":d.backendUrl=config.backendUrl,$.when($("#start").fadeOut(400)).then(function(){a.render("#content-page-login-template",d,"#start"),$('#page-login input[type="text"]').placeholder(),$("#start").fadeIn(400)});break;case"#signup":d.backendUrl=config.backendUrl,d.appUrl=config.appUrl,$.when($("#start").fadeOut(400)).then(function(){a.linkedinData!==!1&&void 0!==a.linkedinData.emailAddress&&""!==a.linkedinData.emailAddress?(d.notFromLinkedIn=!1,d.linkedin={},d.linkedin.name_first=a.linkedinData.firstName,d.linkedin.name_last=a.linkedinData.lastName,d.linkedin.email=a.linkedinData.emailAddress,$(".fullscreenform").fadeIn(400)):d.notFromLinkedIn=!0,a.render("#content-page-register-template",d,"#start"),$('#page-register input[type="text"]').placeholder(),$.each($(".fullscreenform fieldset"),function(a,b){var c=$(b).closest(".fullscreenform"),d=$('<div class="formcontroller" data-field="'+a+'"></div>');$(b).attr("data-field",a),c.find(".formcontrollers").append(d)}),$.each($(".fullscreenform"),function(a,b){$(b).find("fieldset").eq(0).addClass("active"),$(b).find(".formcontroller").eq(0).addClass("enabled active"),$(b).find("fieldset.active").find("input").focus()}),$(".fullscreenform .next").on("click",function(){var a=$(this).closest(".fullscreenform");fullscreenFormNext(a)}),$.each($("#page-register .custom-select"),function(a,b){$(b).find("select").off().on("change",function(){$(this).closest(".custom-select").addClass("used"),$(this).closest(".custom-select").find("label").html($(this).find("option:selected").text())})}),d.notFromLinkedIn||($(".fullscreenform").fadeIn(400),$(".fullscreenform fieldset.active").removeClass("active"),$(".fullscreenform .formcontroller.active").removeClass("active"),$.each($(".fullscreenform fieldset"),function(a,b){var c=$(b).data("field");return $(b).hasClass("education_levels")?($(b).addClass("active"),$(".fullscreenform").find('.formcontroller[data-field="'+c+'"]').addClass("enabled active"),!1):void $(".fullscreenform").find('.formcontroller[data-field="'+c+'"]').addClass("enabled")})),$("#page-register fieldset").keypress(function(a){if(13===a.which){var b=$(this).closest(".fullscreenform");fullscreenFormNext(b)}}),$("#page-register .formcontroller").on("click",function(){if($(this).hasClass("enabled")&&!$(this).hasClass("active")){var a=$(this).data("field"),b=$(this).closest(".fullscreenform");fullscreenFormGoTo(b,a)}}),$("#form-register-submit").on("click",function(){var b={first:$("#register_name_first").val(),last:$("#register_name_last").val(),email:$("#register_email").val(),pass1:$("#register_password").val()?$("#register_password").val():"",pass2:$("#register_password").val()?$("#register_password").val():"",education_level:$("#register_education_level").val()};a.apiCall("register",b,function(b){void 0!==b.metadata.mazhr_token&&(settings.apiToken=b.metadata.mazhr_token,saveData(config.datastore,settings)),a.user.loggedIn=!0,a.user.data=b.data,a.user.metadata=b.metadata,a.refreshTempToken(function(){$.when(a.apiCall("me/filters",JSON.stringify({data:{keywords:"",area:"",profession_code:""}}),function(b){a.user.data.filters=b.data},function(){},"POST")).then(function(){a.showView("#frontpage"),$("#start").fadeOut(400,function(){$("#app").fadeIn(400,function(){a.showLoader=!0})})})},function(){a.logout()})},function(b){var c=JSON.parse(b.responseText);a.message(void 0!==c.error&&"email_in_use"===c.error?"email_in_use":"generic_error")},"POST")}),$("#start").fadeIn(400)});break;case"#frontpage":a.loading.start(),$.when(a.updateMenu(b.slice(1)),$("#content-page").fadeOut(200),$("#content-sidebar").fadeOut(200)).then(function(){a.loading.trickle(),$.when(a.getPossibilities(),a.getMatches()).then(function(){a.loading.trickle(),$("#content-page").fadeIn(200),$(".sidebar-frontpage .anim-in").css({opacity:0}),$("#content-sidebar").fadeIn(200,function(){a.loading.stop(),$.each($(".sidebar-frontpage .anim-in"),function(a,b){var c=b;setTimeout(function(){$(c).animate({opacity:1},300)},150*a)})})})});break;case"#profile":a.loading.start(),$.when(a.apiCall("me",{},function(b){a.user.data=b.data,a.user.metadata=b.metadata,a.updateTestProgress()},function(){a.message("generic_error")},"GET"),a.updateMenu(b.slice(1)),$("#content-page").fadeOut(200),$("#content-sidebar").fadeOut(200)).then(function(){function b(a){return-1!==a.indexOf("facebook.com")?"facebook":-1!==a.indexOf("twitter.com")?"twitter":-1!==a.indexOf("linkedin.com")?"linkedin":-1!==a.indexOf("behance.net")?"behance":-1!==a.indexOf("google.com")?"google-plus":"link"}function c(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];void 0!==f.extras&&void 0!==f.extras[e.id]&&"1"===f.extras[e.id].value&&c.push({id:e.name,name:b[e.name]})}return c}function e(a,b){if(void 0!==a)for(var c=0;c<a.length;c++){var d=a[c];if(void 0!==d.key&&d.key===b)return d.show=!0,""===d.value&&""===d.keywords&&(d.show=!1),d}return{show:!1,key:"",value:""}}a.loading.trickle();var f=a.user.data,g="";null!==f.image&&(g=config.backendUrl+"/uploads/"+f.image);var h={email:{field:"email",value:"",field_name:d.lang.profile.form.contact_fields.email,keywords_array:[],keywords:""},phone:{field:"phone",value:"",field_name:d.lang.profile.form.contact_fields.phone,keywords_array:[],keywords:""}},i=[];void 0!==f.extras.links&&(i=f.extras.links),$.each(i,function(a,c){c.field=b(c.value),c.keywords_array=void 0!==c.keywords&&""!==c.keywords?c.keywords.split(","):[]}),void 0!==f.extras.contact_email&&(h.email={id:f.extras.contact_email.id,shown:!1,field:"email",keywords:f.extras.contact_email.keywords,keywords_array:void 0!==f.extras.contact_email.keywords&&""!==f.extras.contact_email.keywords?f.extras.contact_email.keywords.split(","):[],value:f.extras.contact_email.value,field_name:d.lang.profile.form.contact_fields.email},""!==h.email.value&&(h.email.shown=!0)),void 0!==f.extras.contact_phone&&(h.phone={id:f.extras.contact_phone.id,shown:!1,field:"phone",keywords:f.extras.contact_phone.keywords,keywords_array:void 0!==f.extras.contact_phone.keywords&&""!==f.extras.contact_phone.keywords?f.extras.contact_phone.keywords.split(","):[],value:f.extras.contact_phone.value,field_name:d.lang.profile.form.contact_fields.phone},""!==h.phone.value&&(h.phone.shown=!0));var j={interests:[],locations:[],cards:[],keywords:void 0!==f.extras&&void 0!==f.extras.professional_keywords&&""!==f.extras.professional_keywords.keywords?f.extras.professional_keywords.keywords:"",keywords_array:void 0!==f.extras&&void 0!==f.extras.professional_keywords&&""!==f.extras.professional_keywords.keywords?f.extras.professional_keywords.keywords.split(","):[],also_abroad:[]};j.education_level={id:f.education_level,name:d.lang.education_levels[f.education_level]},j.locations=c([{id:"location_home",name:"home"},{id:"location_abroad",name:"abroad"}],d.lang.profile.form.locations),j.interests=c([{id:"summary_fulltime",name:"fulltime"},{id:"summary_parttime",name:"parttime"},{id:"summary_shifts",name:"shifts"},{id:"summary_evenings_weekends",name:"evenings_weekends"}],d.lang.profile.form.interests),j.cards=c([{id:"card_sanssi",name:"sanssi"},{id:"card_duuni",name:"duuni"}],d.lang.profile.form.cards);var k={};k.leadership=e(f.skills.experience,"leadership"),k.superior=e(f.skills.experience,"superior"),k.entrepreneur=e(f.skills.experience,"entrepreneur"),k.abroad=e(f.skills.experience,"abroad");var l=!1;$.each(k,function(a,b){return b.show===!0?(l=!0,!1):void 0});var m={shown:!1,key:"",value:"",years_value:"",years:""};void 0!==f.skills.primary_experience_type&&void 0!==f.skills.primary_experience_years&&(m=f.skills.primary_experience_type,m.name=d.lang.profile.primary_experience_types[m.value],m.keywords_array=void 0!==m.keywords&&""!==m.keywords?m.keywords.split(","):[],m.years_value=f.skills.primary_experience_years.value,m.years=1===parseInt(m.years_value,10)?m.years_value+" "+d.lang.date_year_single:m.years_value+" "+d.lang.date_years,m.shown=!1,""!==m.value&&""!==m.years_value&&(m.shown=!0)),d.user={name:f.first+" "+f.last,image:g,contact:h,contact_links:i,positions:void 0!==f.workhistory&&f.workhistory.length>0?f.workhistory:[],education:void 0!==f.education&&f.education.length>0?f.education:[],summary:j,languages:void 0!==f.skills.languages&&f.skills.languages.length>0?f.skills.languages:[],experience:k,experience_shown:l,primary_experience:m},$.each(d.user.languages,function(a,b){b.name=void 0!==d.lang.profile.languages[b.key]?d.lang.profile.languages[b.key].name.capitalizeFirstLetter():b.key,b.score=getStars(b.value),b.keywords_array=void 0!==b.keywords&&""!==b.keywords?b.keywords.split(","):[]}),$.each(d.user.experience,function(a,b){b.name=d.lang.profile.form.experience_fields[b.key],b.keywords_array=void 0!==b.keywords&&""!==b.keywords?b.keywords.split(","):[],b.years=1===parseInt(b.value,10)?b.value+" "+d.lang.date_year_single:b.value+" "+d.lang.date_years}),$.each(d.user.positions,a.parsePosition),$.each(d.user.education,a.parseEducation),a.render("#content-sidebar-profile-template",d,"#content-sidebar"),a.render("#content-page-profile-template",d,"#content-page"),$('#content-page input[type="text"]').placeholder(),$.when(a.apiCall("tests",{},function(b){if(a.user.data.tests.length){var c=[];checkAndAdd(102,a.user.data.tests,c),checkAndAdd(201,a.user.data.tests,c),checkAndAdd(302,a.user.data.tests,c),checkAndAdd(301,a.user.data.tests,c),checkAndAdd(357,a.user.data.tests,c),checkAndAdd(315,a.user.data.tests,c),$.each(c,function(c,e){if(void 0!==b.data[e.instrument_id]&&""!==e.score_key&&null!==e.score_key){var f=b.data[e.instrument_id].name,g=e.score+"",h={};1===g.length?(h={value:g,text:{title:d.lang.tests.testdata[f].name,description:d.lang.tests.result_texts[g]}},a.render("#diagram-template",h,"#profile-diagrams",!0)):(h={text:{title:d.lang.tests.testdata[f].name,description:g}},a.render("#text-result-template",h,"#text-results",!0))}})}},function(){},"GET")).then(function(){$("#content-page").fadeIn(200),$("#content-sidebar").fadeIn(200,function(){a.loading.stop()})})});break;case"#tests":a.loading.start(),$.when(a.updateMenu(b.slice(1)),$("#content-page").fadeOut(200),$("#content-sidebar").fadeOut(200)).then(function(){a.loading.trickle(),a.render("#content-sidebar-tests-template",d,"#content-sidebar"),$.when(a.getTests()).then(function(){a.loading.trickle(),$("#content-page").fadeIn(200),$("#content-sidebar").fadeIn(200,function(){a.loading.stop()})})});break;case"#settings":a.loading.start(),$.when(a.updateMenu(b.slice(1)),$("#content-page").fadeOut(200),$("#content-sidebar").fadeOut(200)).then(function(){if(a.loading.trickle(),d.privacysettings={public_profile_bool:!1,show:{},profile_url:config.profileUrl+"#"+a.user.data.privacy.profile_token},void 0!==a.user.data.privacy&&1===a.user.data.privacy.public_profile&&(d.privacysettings.public_profile_bool=!0),void 0!==a.user.data.privacy&&null!==a.user.data.privacy.show&&""!==a.user.data.privacy.show){var b=a.user.data.privacy.show.split(",");$.each(b,function(a,b){d.privacysettings.show[b]=!0})}d.privacysettings.public_profile_bool===!1&&$.isEmptyObject(d.privacysettings.show)&&(d.privacysettings.show={workhistory:!0,education:!0,skills:!0,extras:!0,tests:!0,image:!0}),a.render("#content-sidebar-settings-template",d,"#content-sidebar"),a.render("#content-page-settings-template",d,"#content-page"),d.privacysettings.public_profile_bool===!0?($("#privacy-checkboxes").show(),$("#privacy-link").show()):($("#privacy-checkboxes").hide(),$("#privacy-link").hide()),$('#content-page input[type="text"]').placeholder(),$("#content-page").fadeIn(200),$("#content-sidebar").fadeIn(200,function(){a.loading.stop()})})}}},function(){return window.location.hash=a.view,!1})},a.init=function(){var b=getInternetExplorerVersion();-1!==b&&10>b&&(log("Old IE"),log("Disabling image cropper"),a.imageCropperEnabled=!1,$("html").addClass("old-ie")),-1!==b&&(log("Adding IE class to html"),$("html").addClass("ie")),a.linkedinData=!1,$.when(a.loadTranslation("fi_fi","languages/finnish.json"),a.loadTranslation("en_en","languages/english.json"),a.loadTranslation("sv_se","languages/swedish.json")).then(function(){if("undefined"!=typeof legacyBrowser){var b={lang:a.translations[a.currentLanguage]},c=window.Handlebars.compile($("#content-browser-nag-template").html());return $("#browser-nag").html(c(b)),$("body").css({overflow:"hidden"}),$("#loader").fadeOut(400,function(){$("#browser-nag").fadeIn(400,function(){})}),!1}a.imageCropperEnabled===!0?(a.render("#content-uploader-template",{lang:a.translations[a.currentLanguage]},"#uploader",!0),$("#image-cropper").cropit({imageBackground:!1,width:260,height:260,exportZoom:2,onFileReaderError:function(){a.message("uploader_image_error"),$("#uploader").fadeOut(200)},onImageLoaded:function(){$("#uploader").fadeIn(200)},onImageError:function(){a.message("uploader_image_error"),$("#uploader").fadeOut(200)}}),$(document).on("click",'[role="cancel-profile-image"]',function(){$("#uploader").fadeOut(200)}),$(document).on("click",'[role="save-profile-image"]',function(){var b=$("#image-cropper").cropit("export",{type:"image/jpeg",quality:.8});a.saveProfileImage(b)}),$(document).on("click","#sidebar-profile .imagewrapper",function(){$(".cropit-image-input").click()})):$(document).on("click","#sidebar-profile .imagewrapper",function(){a.message("uploader_oldbrowser")}),$(document).on("click",'.pageselector[data-page="frontpage"]',function(){a.matchOpen!==!1&&(a.matchOpen=!1,a.matchArea=!1,a.matchKeywords="",a.showView("#frontpage",!0))}),moment.locale(a.translations[a.currentLanguage].moment_lang),a.loginCheck(function(){a.refreshTempToken(function(){a.showView(window.location.hash),$("#loader").fadeOut(400,function(){$("#app").fadeIn(400,function(){a.showLoader=!0})})},function(){a.logout()})},function(){$("#loader").delay(400).fadeOut(600,function(){a.showView(window.location.hash),a.showLoader=!0})})})}}window.onunload=function(){},Object.size=function(a){"use strict";var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c};var emailCheck=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,phoneCheck=/^[0-9 \-+()]+$/,debug=!0,config={appUrl:null,profileUrl:"https://www.mazhr.com/profile/",backendUrl:"//api.mazhr.com",apiPath:"api/v1",datastore:"mahzr_app_v1_settings",publicViews:["#start","#login","#signup","#tryout"],allowedViews:["#frontpage","#profile","#tests","#settings"],confirmButtonColor:"#00b0a0",destructiveButtonColor:"#c44040"};window.Handlebars.registerHelper("select",function(a,b){"use strict";var c=$("<select />").html(b.fn(this));return c.find('[value="'+a+'"]').attr({selected:"selected"}),c.html()}),window.Handlebars.registerHelper("checkArray",function(a,b){"use strict";for(var c=$("<div />").html(b.fn(this)),d=0;d<a.length;d++)c.find("input[name="+a[d].id+"]").attr({checked:"checked"});return c.html()}),window.Handlebars.registerHelper("checkRadio",function(a,b){"use strict";for(var c=$("<div />").html(b.fn(this)),d=0;d<a.length;d++)c.find("input[value="+a[d].id+"]").attr({checked:"checked"});return c.html()}),window.Handlebars.registerHelper("ifNotEmpty",function(a,b){"use strict";return void 0!==a&&""!==a&&0!==a.length?b.fn(this):void 0}),String.prototype.capitalizeFirstLetter=function(){"use strict";return this.charAt(0).toUpperCase()+this.slice(1)};var settings=loadData(config.datastore);null===settings&&(settings={language:"fi_fi"}),$(document).ready(function(){"use strict";$.ajaxSetup({cache:!1}),config.appUrl=getCurrentUrl(),FastClick.attach(document.body);var a=new App;a.init(),$(window).bind("hashchange",a.hashChanged),$(document).on("submit","#form-forgot-password",function(b){b.preventDefault(),a.forgotPassword()}),$(document).on("submit","#change-password",function(b){b.preventDefault(),a.changePassword()}),$(document).on("submit","#change-email",function(b){b.preventDefault(),a.changeEmail()}),$(document).on("submit","#form-login",function(b){b.preventDefault();var c=$(this).find('input[name="email"]').val(),d=$(this).find('input[name="password"]').val(),e=!0;""!==d&&""!==c&&emailCheck.test(c)?a.login(c,d,e):a.message("login_validate_failed")}),$(document).on("submit",".form-discountcode",function(b){b.preventDefault();var c=$(this).find('input[name="testid"]').val(),d=$(this).find('input[name="discountcode"]').val();a.saveOpenTests(),a.submitDiscount(c,d)}),$(document).on("click",".forgot-toggle",function(){$("#form-forgot-password").slideToggle()}),$(document).on("click",".match",function(){var b=$(this).data("matchid");a.openMatch(b)}),$(document).on("click",'[role="change-language"]',function(){var b=$(this).data("locale");a.changeLanguage(b)}),$(document).on("click",'[role="save-password"]',function(){a.changePassword()}),$(document).on("click",'[role="save-privacy"]',function(){a.savePrivacy()}),$(document).on("change","#profile-privacy",function(){$(this).hasClass("editing")||$(this).addClass("editing")}),$(document).on("change","#privacy-public",function(){$(this).is(":checked")?($("#privacy-checkboxes").slideDown(200),$("#privacy-link").slideDown(200)):($("#privacy-checkboxes").slideUp(200),$("#privacy-link").slideUp(200))}),$(document).on("click",'[role="save-email"]',function(){a.changeEmail()}),$(document).on("click",'[role="open-faq"]',function(){var a=$(this).closest(".faqitem");$(a).hasClass("active")?($(".faqitem .text").stop(!0,!1).slideUp(200),$(".faqitem").removeClass("active")):($(".faqitem .text").stop(!0,!1).slideUp(200),$(".faqitem").removeClass("active"),$(a).addClass("active"),$(a).find(".text").stop(!0,!1).slideDown(200))}),$(document).on("click",'[role="open-registration"]',function(){$("#page-register .choice").fadeOut(400,function(){$(".fullscreenform").fadeIn(400)})}),$(document).on("click",".possibility",function(){var b=$(this).data("jobid");a.openJob(b)}),$(document).on("click","#button-back.close-job",function(b){b.preventDefault(),b.stopPropagation(),a.closeJob()}),$(document).on("click","#button-back.close-match",function(){a.closeMatch()}),$(document).on("click",'[role="logout"]',function(){a.logout()}),$(document).on("click",'[role="linkedin-fetch"]',function(){a.fetchLinkedin()}),$(document).on("click",'[role="remove-account"]',function(){a.removeAccount()}),window.onbeforeunload=function(){var b=a.translations[a.currentLanguage];return $(".editor.editing").length>0?b.alerts.unsaved:void 0},$(document).on("click",'[role="edit-start"]',function(){if(!$(".page-profile").hasClass("edit-open")){var b=a.translations[a.currentLanguage],c=this;$.each($(c).closest(".editor").find(".keywords[data-autocomplete]"),function(a,c){$(c).tagit({availableTags:b.autocomplete[$(c).data("autocomplete")]})}),$.each($(c).closest(".editor").find('input[data-autocomplete="degrees"]'),function(a,c){$(c).autocomplete({source:b.autocomplete[$(c).data("autocomplete")]})}),$(this).closest(".editor").addClass("editing"),$(this).closest(".page-profile").addClass("edit-open")}}),$(document).on("click",'[role="edit-cancel"]',function(){a.onLeaveCheck(!1,function(){a.redrawAll(!0)},function(){})}),$(document).on("click",'[role="add-new-position"]',a.addNewPosition),$(document).on("click",'.experience [role="edit-save"]',a.savePositions),$(document).on("click",'[role="remove-position"]',function(){var a=$(this).closest(".row.position");a.slideUp(function(){a.hasClass("new")?a.remove():a.addClass("remove")})}),$(document).on("click",'[role="add-new-education"]',a.addNewEducation),$(document).on("click",'.education [role="edit-save"]',a.saveEducation),$(document).on("click",'[role="remove-education"]',function(){var a=$(this).closest(".row.education");a.slideUp(function(){a.hasClass("new")?a.remove():a.addClass("remove")})}),$(document).on("click",'[role="add-new-link"]',a.addNewLink),$(document).on("click",'.contacts [role="edit-save"]',a.saveContact),$(document).on("click",'[role="remove-link"]',function(){var a=$(this).closest(".row.link");a.slideUp(function(){a.hasClass("new")?a.remove():a.addClass("remove")})}),$(document).on("click",'.summary [role="edit-save"]',a.saveSummary),$(document).on("click",'[role="add-new-language"]',a.addNewLanguage),$(document).on("click",'[role="remove-language"]',function(){var a=$(this).closest(".subrow.language");a.slideUp(function(){a.hasClass("new")?a.remove():a.addClass("remove")})}),$(document).on("click",'.skills [role="edit-save"]',a.saveSkills),$(document).on("change",'fieldset.edit-time input[type="checkbox"]',function(){var a=$(this).closest("fieldset");$(this).prop("checked")===!0?a.addClass("not-ended"):a.removeClass("not-ended")}),$(document).on("click",".start-test",function(){var b=$(this).closest("form").find(".language");b.removeClass("error");var c=$(this).closest("form").find('[name="language"]').val();if(""!==c){var d=$(this).data("instrument"),e=$(this).data("test");a.startTest(d,e,c)}else $(b).addClass("error")}),$(document).on("click",".reset-test",function(){var b=$(this).data("testid");a.resetTest(b)}),$(document).on("click",'[role="buy-test"]',function(){var b=$(this).data("instrument");a.saveOpenTests(),window.location=config.backendUrl+"/paytrail/payment?mazhr_token="+settings.tempToken+"&instrument="+b+"&return_url="+encodeURIComponent(config.appUrl+"#tests")}),$(document).on("click",".reset-payment",function(){var b=$(this).data("testid");a.resetPayment(b)}),$(document).on("click",".discountcode .openform",function(){var a=this;$(this).slideUp(100,function(){$(a).closest(".discountcode").find(".form-discountcode").delay(100).slideDown(100)})}),$(document).on("click",'[role="login-linkedin"]',function(){window.location=config.backendUrl+"/linkedin?mazhr_token="+settings.tempToken+"&ok_url="+encodeURIComponent(config.appUrl+"#signup")+"&fail_url="+encodeURIComponent(config.appUrl+"#login")}),$(document).on("click",'[role="register-linkedin"]',function(){window.location=config.backendUrl+"/linkedin?mazhr_token="+settings.tempToken+"&ok_url="+encodeURIComponent(config.appUrl+"#signup")+"&fail_url="+encodeURIComponent(config.appUrl+"#start")}),$(document).on("click",".readmore",function(){$(this).hide(),$(this).parent().parent().find(".more").show()}),$(document).on("click",".test .title",function(){var a=$(this).closest(".test");$(a).hasClass("open")?$(a).find(".info").slideUp(200,function(){$(a).removeClass("open")}):$(a).find(".info").slideDown(200,function(){$(a).addClass("open")})}),$(document).on("click",".start-loading",function(){})});
