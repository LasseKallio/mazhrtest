function getInternetExplorerVersion(){"use strict";var a=-1;if("Microsoft Internet Explorer"===navigator.appName){var b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!==c.exec(b)&&(a=parseFloat(RegExp.$1))}return a}function getCurrentUrl(){"use strict";var a=window.location.href;return-1!==a.indexOf("#")&&(a=a.substr(0,a.indexOf("#"))),a}function checkAndAdd(a,b,c){"use strict";for(var d=0;d<b.length;d++){var e=b[d];if(e.instrument_id===a)return c.push(e),!0}return!1}function shuffle(a){"use strict";for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}function log(a){"use strict";debug&&void 0!==console&&void 0!==console.log&&console.log(a)}function getStars(a){"use strict";for(var b="",c=0,d=1;5>=d;d++){if(!(a>=d)){a%1!==0&&(c++,b+='<span class="star halfstar"></span>');break}c++,b+='<span class="star fullstar"></span>'}for(;5>c;)b+='<span class="star emptystar"></span>',c++;return b}function getStarsFromScore(a){"use strict";a=parseInt(a,10);var b=.5*(a+1);return getStars(b)}function loadData(a){"use strict";return void 0!==localStorage?null===localStorage.getItem(a)?null:JSON.parse(localStorage.getItem(a)):null}function App(){"use strict";var a=this;a.currentLanguage=settings.language?settings.language:"fi_fi",a.translations={},a.loadTranslation=function(b,c){var d=new $.Deferred;return $.get(c,function(c){void 0!==c&&(a.translations[b]=c,d.resolve("OK"))},"json"),d.promise()},a.getApiUrl=function(a){var b=config.backendUrl+"/";return b+=a},a.apiCall=function(b,c,d,e,f,g){var h={},i={type:f,headers:h,dataType:"JSON",data:c};void 0!==g&&g===!0&&(i.processData=!1,i.contentType=!1);var j=$.ajax(a.getApiUrl(b),i).done(function(a){d(a)}).fail(function(a,b,c){e(a,b,c)});return j},a.message=function(b){var c=a.translations[a.currentLanguage],d=c.alerts.messages[b],e=d.title,f=d.message,g=d.type;sweetAlert({title:e,text:f,type:g,confirmButtonText:c.alerts.messages.ok,confirmButtonColor:config.confirmButtonColor,closeOnConfirm:!1},function(){window.location.href="https://www.mazhr.com"})},a.render=function(a,b,c,d){void 0===c&&(c="#content-page"),void 0===d&&(d=!1);var e=$(a).html(),f=window.Handlebars.compile(e),g=f(b);d?$(c).append(g):$(c).html(g)},a.parsePosition=function(b,c){var d,e,f,g={lang:a.translations[a.currentLanguage]},h=c.start_month+"/"+c.start_year;1===c.current?(d=g.lang.profile.time_current,f=moment.duration(moment().diff(moment(h,"M/YYYY"))),c.not_ended=!0):(d=c.end_month+"/"+c.end_year,f=moment.duration(moment(d,"M/YYYY").diff(moment(h,"M/YYYY")))),0!==f.asYears()?(e=Math.round(f.asYears()),e+=1===e?" "+g.lang.date_year_single:" "+g.lang.date_years):(e=Math.round(f.asMonths()),e+=1===e?" "+g.lang.date_month_single:" "+g.lang.date_months),c.start_pretty=h,c.end_pretty=d,c.duration_pretty=e,c.end_month=null===c.end_month?"":c.end_month,c.end_year=null===c.end_year?"":c.end_year,c.keywords_array=null!==c.keywords&&""!==c.keywords?c.keywords.split(","):[]},a.parseEducation=function(b,c){var d,e={lang:a.translations[a.currentLanguage]};1===c.current?(d=e.lang.profile.form.education_not_ended,c.not_ended=!0):d=e.lang.profile.form.end_year+" "+c.end_year,c.duration_pretty=d,c.keywords_array=null!==c.keywords&&""!==c.keywords?c.keywords.split(","):[]},a.loadData=function(b){var c,d={lang:a.translations[a.currentLanguage]};$.when(a.apiCall("profile/"+b,{},function(a){c=a.data},function(){a.message("profileid_error"),$("#loader").fadeOut(400,function(){})},"GET")).then(function(){function b(a){return-1!==a.indexOf("facebook.com")?"facebook":-1!==a.indexOf("twitter.com")?"twitter":-1!==a.indexOf("linkedin.com")?"linkedin":-1!==a.indexOf("behance.net")?"behance":-1!==a.indexOf("google.com")?"google-plus":"link"}function e(a,b){for(var d=[],e=0;e<a.length;e++){var f=a[e];void 0!==c.extras&&void 0!==c.extras[f.id]&&"1"===c.extras[f.id].value&&d.push({id:f.name,name:b[f.name]})}return d}function f(a,b){if(void 0!==a)for(var c=0;c<a.length;c++){var d=a[c];if(void 0!==d.key&&d.key===b)return d.show=!0,""===d.value&&""===d.keywords&&(d.show=!1),d}return{show:!1,key:"",value:""}}var g={extras:void 0===c.extras,education:void 0===c.education,skills:void 0===c.skills,workhistory:void 0===c.workhistory};d.hidden_blocks=g,console.log(g);var h="";null!==c.image&&(h=config.backendUrl+"/uploads/"+c.image);var i={email:{field:"email",value:"",field_name:d.lang.profile.form.contact_fields.email,keywords_array:[],keywords:""},phone:{field:"phone",value:"",field_name:d.lang.profile.form.contact_fields.phone,keywords_array:[],keywords:""}},j=[];void 0!==c.extras&&(d.show_extras=!0,void 0!==c.extras.links&&(j=c.extras.links),$.each(j,function(a,c){c.field=b(c.value),c.keywords_array=void 0!==c.keywords&&""!==c.keywords?c.keywords.split(","):[]}),void 0!==c.extras.contact_email&&(i.email={id:c.extras.contact_email.id,shown:!1,field:"email",keywords:c.extras.contact_email.keywords,keywords_array:void 0!==c.extras.contact_email.keywords&&""!==c.extras.contact_email.keywords?c.extras.contact_email.keywords.split(","):[],value:c.extras.contact_email.value,field_name:d.lang.profile.form.contact_fields.email},""!==i.email.value&&(i.email.shown=!0)),void 0!==c.extras.contact_phone&&(i.phone={id:c.extras.contact_phone.id,shown:!1,field:"phone",keywords:c.extras.contact_phone.keywords,keywords_array:void 0!==c.extras.contact_phone.keywords&&""!==c.extras.contact_phone.keywords?c.extras.contact_phone.keywords.split(","):[],value:c.extras.contact_phone.value,field_name:d.lang.profile.form.contact_fields.phone},""!==i.phone.value&&(i.phone.shown=!0)));var k={interests:[],locations:[],cards:[],keywords:void 0!==c.extras&&void 0!==c.extras.professional_keywords&&""!==c.extras.professional_keywords.keywords?c.extras.professional_keywords.keywords:"",keywords_array:void 0!==c.extras&&void 0!==c.extras.professional_keywords&&""!==c.extras.professional_keywords.keywords?c.extras.professional_keywords.keywords.split(","):[],also_abroad:[]};void 0!==c.extras&&(k.education_level={id:c.education_level,name:d.lang.education_levels[c.education_level]}),k.locations=e([{id:"location_home",name:"home"},{id:"location_abroad",name:"abroad"}],d.lang.profile.form.locations),k.interests=e([{id:"summary_fulltime",name:"fulltime"},{id:"summary_parttime",name:"parttime"},{id:"summary_shifts",name:"shifts"},{id:"summary_evenings_weekends",name:"evenings_weekends"}],d.lang.profile.form.interests),k.cards=e([{id:"card_sanssi",name:"sanssi"},{id:"card_duuni",name:"duuni"}],d.lang.profile.form.cards);var l,m={},n=!1;if(void 0!==c.skills&&(m.leadership=f(c.skills.experience,"leadership"),m.superior=f(c.skills.experience,"superior"),m.entrepreneur=f(c.skills.experience,"entrepreneur"),m.abroad=f(c.skills.experience,"abroad"),$.each(m,function(a,b){return b.show===!0?(n=!0,!1):void 0}),l={shown:!1,key:"",value:"",years_value:"",years:""},void 0!==c.skills.primary_experience_type&&void 0!==c.skills.primary_experience_years&&(l=c.skills.primary_experience_type,l.name=d.lang.profile.primary_experience_types[l.value],l.keywords_array=void 0!==l.keywords&&""!==l.keywords?l.keywords.split(","):[],l.years_value=c.skills.primary_experience_years.value,l.years=1===parseInt(l.years_value,10)?l.years_value+" "+d.lang.date_year_single:l.years_value+" "+d.lang.date_years,l.shown=!1,""!==l.value&&""!==l.years_value&&(l.shown=!0))),d.user={name:c.first+" "+c.last,image:h,contact:i,contact_links:j,positions:void 0!==c.workhistory&&c.workhistory.length>0?c.workhistory:[],education:void 0!==c.education&&c.education.length>0?c.education:[],summary:k,languages:void 0!==c.skills&&void 0!==c.skills.languages&&c.skills.languages.length>0?c.skills.languages:[],experience:m,experience_shown:n,primary_experience:l},void 0!==c.skills&&$.each(d.user.languages,function(a,b){b.name=void 0!==d.lang.profile.languages[b.key]?d.lang.profile.languages[b.key].name.capitalizeFirstLetter():b.key,b.score=getStars(b.value),b.keywords_array=void 0!==b.keywords&&""!==b.keywords?b.keywords.split(","):[]}),$.each(d.user.experience,function(a,b){b.name=d.lang.profile.form.experience_fields[b.key],b.keywords_array=void 0!==b.keywords&&""!==b.keywords?b.keywords.split(","):[],b.years=1===parseInt(b.value,10)?b.value+" "+d.lang.date_year_single:b.value+" "+d.lang.date_years}),$.each(d.user.positions,a.parsePosition),$.each(d.user.education,a.parseEducation),a.render("#menu-template",d,"#menu"),a.render("#content-sidebar-profile-template",d,"#content-sidebar"),a.render("#content-page-profile-template",d,"#content-page"),$('#content-page input[type="text"]').placeholder(),void 0!==c.tests&&c.tests.length){var o=[];checkAndAdd(102,c.tests,o),checkAndAdd(201,c.tests,o),checkAndAdd(302,c.tests,o),checkAndAdd(301,c.tests,o),checkAndAdd(357,c.tests,o),checkAndAdd(315,c.tests,o),$.each(o,function(b,c){if(""!==c.score_key&&null!==c.score_key){var e=d.lang.tests.testids["test-"+c.instrument_id],f=c.score+"",g={};1===f.length?(g={value:f,text:{title:d.lang.tests.testdata[e].name,description:d.lang.tests.result_texts[f]}},a.render("#diagram-template",g,"#profile-diagrams",!0)):(g={text:{title:d.lang.tests.testdata[e].name,description:f}},a.render("#text-result-template",g,"#text-results",!0))}})}$("#content-page").show(),$("#content-sidebar").show(),$("#loader").fadeOut(400,function(){$("#app").fadeIn(400,function(){})})})},a.init=function(){var b=getInternetExplorerVersion();-1!==b&&10>b&&(log("Old IE"),$("html").addClass("old-ie")),-1!==b&&(log("Adding IE class to html"),$("html").addClass("ie")),$(window).bind("hashchange",function(){document.location.reload(!0)}),$.when(a.loadTranslation("fi_fi","../languages/finnish.json"),a.loadTranslation("en_en","../languages/english.json"),a.loadTranslation("sv_se","../languages/swedish.json")).then(function(){if("undefined"!=typeof legacyBrowser){var b={lang:a.translations[a.currentLanguage]},c=window.Handlebars.compile($("#content-browser-nag-template").html());return $("#browser-nag").html(c(b)),$("body").css({overflow:"hidden"}),$("#loader").fadeOut(400,function(){$("#browser-nag").fadeIn(400,function(){})}),!1}if(moment.locale(a.translations[a.currentLanguage].moment_lang),""!==window.location.hash){var d=window.location.hash.substring(1);a.loadData(d)}else $("#loader").fadeOut(400,function(){}),a.message("profileid_error")})}}window.onunload=function(){};var debug=!0,config={appUrl:null,backendUrl:"//api.mazhr.com",confirmButtonColor:"#00b0a0",destructiveButtonColor:"#c44040"};window.Handlebars.registerHelper("select",function(a,b){"use strict";var c=$("<select />").html(b.fn(this));return c.find('[value="'+a+'"]').attr({selected:"selected"}),c.html()}),window.Handlebars.registerHelper("checkArray",function(a,b){"use strict";for(var c=$("<div />").html(b.fn(this)),d=0;d<a.length;d++)c.find("input[name="+a[d].id+"]").attr({checked:"checked"});return c.html()}),window.Handlebars.registerHelper("checkRadio",function(a,b){"use strict";for(var c=$("<div />").html(b.fn(this)),d=0;d<a.length;d++)c.find("input[value="+a[d].id+"]").attr({checked:"checked"});return c.html()}),window.Handlebars.registerHelper("ifNotEmpty",function(a,b){"use strict";return void 0!==a&&""!==a&&0!==a.length?b.fn(this):void 0}),String.prototype.capitalizeFirstLetter=function(){"use strict";return this.charAt(0).toUpperCase()+this.slice(1)};var settings=loadData(config.datastore);null===settings&&(settings={language:"fi_fi"}),$(document).ready(function(){"use strict";$.ajaxSetup({cache:!1}),config.appUrl=getCurrentUrl(),FastClick.attach(document.body);var a=new App;a.init()});
